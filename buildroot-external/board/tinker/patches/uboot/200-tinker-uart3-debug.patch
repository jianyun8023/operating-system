From db6c0eae291df886af7efd46703b78b0129ecb22 Mon Sep 17 00:00:00 2001
From: Pascal Vizeli <pvizeli@syshack.ch>
Date: Fri, 3 Aug 2018 10:22:02 +0000
Subject: [PATCH 1/1] tinker uart3 debug

Signed-off-by: Pascal Vizeli <pvizeli@syshack.ch>
---
 arch/arm/dts/rk3288-tinker.dts            |  4 ++--
 arch/arm/mach-rockchip/rk3288-board-spl.c | 10 ++++++----
 configs/tinker-rk3288_defconfig           |  2 +-
 3 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/arch/arm/dts/rk3288-tinker.dts b/arch/arm/dts/rk3288-tinker.dts
index 3edd21cc2f4..372ab8bacdb 100644
--- a/arch/arm/dts/rk3288-tinker.dts
+++ b/arch/arm/dts/rk3288-tinker.dts
@@ -11,7 +11,7 @@
 	compatible = "rockchip,rk3288-tinker", "rockchip,rk3288";
 
 	chosen {
-		stdout-path = &uart2;
+		stdout-path = &uart3;
 	};
 };
 
@@ -41,7 +41,7 @@
 	status = "okay";
 };
 
-&uart2 {
+&uart3 {
 	u-boot,dm-pre-reloc;
 	reg-shift = <2>;
 };
diff --git a/arch/arm/mach-rockchip/rk3288-board-spl.c b/arch/arm/mach-rockchip/rk3288-board-spl.c
index ea6a14af4f0..8b7fa053a8d 100644
--- a/arch/arm/mach-rockchip/rk3288-board-spl.c
+++ b/arch/arm/mach-rockchip/rk3288-board-spl.c
@@ -154,10 +154,12 @@ void board_init_f(ulong dummy)
 #define GRF_BASE	0xff770000
 	struct rk3288_grf * const grf = (void *)GRF_BASE;
 
-	rk_clrsetreg(&grf->gpio7ch_iomux, GPIO7C7_MASK << GPIO7C7_SHIFT |
-		     GPIO7C6_MASK << GPIO7C6_SHIFT,
-		     GPIO7C7_UART2DBG_SOUT << GPIO7C7_SHIFT |
-		     GPIO7C6_UART2DBG_SIN << GPIO7C6_SHIFT);
+	rk_clrsetreg(&grf->gpio7a_iomux,
+				GPIO7A7_MASK << GPIO7A7_SHIFT,
+				GPIO7A7_UART3GPS_SIN << GPIO7A7_SHIFT);
+	rk_clrsetreg(&grf->gpio7b_iomux,
+				GPIO7B0_MASK << GPIO7B0_SHIFT,
+				GPIO7B0_UART3GPS_SOUT << GPIO7B0_SHIFT);
 	/*
 	 * Debug UART can be used from here if required:
 	 *
diff --git a/configs/tinker-rk3288_defconfig b/configs/tinker-rk3288_defconfig
index 679d6e29eaf..5f8da09ded8 100644
--- a/configs/tinker-rk3288_defconfig
+++ b/configs/tinker-rk3288_defconfig
@@ -5,7 +5,7 @@ CONFIG_SYS_MALLOC_F_LEN=0x2000
 CONFIG_ROCKCHIP_RK3288=y
 CONFIG_SPL_ROCKCHIP_BACK_TO_BROM=y
 CONFIG_TARGET_TINKER_RK3288=y
-CONFIG_DEBUG_UART_BASE=0xff690000
+CONFIG_DEBUG_UART_BASE=0xff1b0000
 CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_SPL_STACK_R_ADDR=0x80000
 CONFIG_DEFAULT_DEVICE_TREE="rk3288-tinker"
-- 
2.17.1

