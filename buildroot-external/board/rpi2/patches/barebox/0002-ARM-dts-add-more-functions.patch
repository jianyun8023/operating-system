From 1f5edc2b907c89a3e27f55490479a0999b1127dc Mon Sep 17 00:00:00 2001
From: Pascal Vizeli <pvizeli@syshack.ch>
Date: Mon, 4 Jun 2018 09:17:25 +0000
Subject: [PATCH 2/2] ARM: dts: add more functions

Signed-off-by: Pascal Vizeli <pvizeli@syshack.ch>
---
 arch/arm/dts/bcm2835-rpi.dts   |  4 ----
 arch/arm/dts/bcm2836-rpi-2.dts |  4 ----
 dts/src/arm/bcm2835-rpi.dtsi   | 38 ++++++++++++++++++++++++++++++++--
 dts/src/arm/bcm283x.dtsi       | 12 ++++-------
 4 files changed, 40 insertions(+), 18 deletions(-)

diff --git a/arch/arm/dts/bcm2835-rpi.dts b/arch/arm/dts/bcm2835-rpi.dts
index c23e7c7c1..22d60e961 100644
--- a/arch/arm/dts/bcm2835-rpi.dts
+++ b/arch/arm/dts/bcm2835-rpi.dts
@@ -1,10 +1,6 @@
 #include <arm/bcm2835-rpi-a.dts>
 
 / {
-	chosen {
-		stdout-path = &uart0;
-	};
-
 	memory {
 		reg = <0x0 0x0>;
 	};
diff --git a/arch/arm/dts/bcm2836-rpi-2.dts b/arch/arm/dts/bcm2836-rpi-2.dts
index 2fa1c8bb4..bdee1296e 100644
--- a/arch/arm/dts/bcm2836-rpi-2.dts
+++ b/arch/arm/dts/bcm2836-rpi-2.dts
@@ -1,10 +1,6 @@
 #include <arm/bcm2836-rpi-2-b.dts>
 
 / {
-	chosen {
-		stdout-path = &uart0;
-	};
-
 	memory {
 		reg = <0x0 0x0>;
 	};
diff --git a/dts/src/arm/bcm2835-rpi.dtsi b/dts/src/arm/bcm2835-rpi.dtsi
index e36c392a2..86f1d493c 100644
--- a/dts/src/arm/bcm2835-rpi.dtsi
+++ b/dts/src/arm/bcm2835-rpi.dtsi
@@ -27,6 +27,39 @@
 			firmware = <&firmware>;
 			#power-domain-cells = <1>;
 		};
+
+		fb: fb {
+			compatible = "brcm,bcm2708-fb";
+			firmware = <&firmware>;
+			status = "okay";
+		};
+
+		vchiq: vchiq {
+			compatible = "brcm,bcm2835-vchiq";
+			reg = <0x7e00b840 0xf>;
+			interrupts = <0 2>;
+			cache-line-size = <32>;
+			firmware = <&firmware>;
+		};
+
+		vcsm: vcsm {
+			compatible = "raspberrypi,bcm2835-vcsm";
+			firmware = <&firmware>;
+			status = "okay";
+		};
+
+		/* Onboard audio */
+		audio: audio {
+			compatible = "brcm,bcm2835-audio";
+			brcm,pwm-channels = <8>;
+			status = "okay";
+		};
+
+		/* External sound card */
+		sound: sound {
+			status = "disabled";
+		};
+
 	};
 };
 
@@ -91,12 +124,12 @@
 
 &hdmi {
 	power-domains = <&power RPI_POWER_DOMAIN_HDMI>;
-	status = "okay";
+	status = "disabled";
 };
 
 &vec {
 	power-domains = <&power RPI_POWER_DOMAIN_VEC>;
-	status = "okay";
+	status = "disabled";
 };
 
 &dsi0 {
@@ -106,3 +139,4 @@
 &dsi1 {
 	power-domains = <&power RPI_POWER_DOMAIN_DSI1>;
 };
+
diff --git a/dts/src/arm/bcm283x.dtsi b/dts/src/arm/bcm283x.dtsi
index 9d293decf..0abb72a47 100644
--- a/dts/src/arm/bcm283x.dtsi
+++ b/dts/src/arm/bcm283x.dtsi
@@ -26,10 +26,6 @@
 		serial1 = &uart1;
 	};
 
-	chosen {
-		stdout-path = "serial0:115200n8";
-	};
-
 	thermal-zones {
 		cpu_thermal: cpu-thermal {
 			polling-delay-passive = <0>;
@@ -426,13 +422,13 @@
 			status = "disabled";
 		};
 
-		pixelvalve@7e206000 {
+		pixelvalve0: pixelvalve@7e206000 {
 			compatible = "brcm,bcm2835-pixelvalve0";
 			reg = <0x7e206000 0x100>;
 			interrupts = <2 13>; /* pwa0 */
 		};
 
-		pixelvalve@7e207000 {
+		pixelvalve1: pixelvalve@7e207000 {
 			compatible = "brcm,bcm2835-pixelvalve1";
 			reg = <0x7e207000 0x100>;
 			interrupts = <2 14>; /* pwa1 */
@@ -518,7 +514,7 @@
 			status = "disabled";
 		};
 
-		hvs@7e400000 {
+		hvs: hvs@7e400000 {
 			compatible = "brcm,bcm2835-hvs";
 			reg = <0x7e400000 0x6000>;
 			interrupts = <2 1>;
@@ -572,7 +568,7 @@
 			status = "disabled";
 		};
 
-		pixelvalve@7e807000 {
+		pixelvalve2: pixelvalve@7e807000 {
 			compatible = "brcm,bcm2835-pixelvalve2";
 			reg = <0x7e807000 0x100>;
 			interrupts = <2 10>; /* pixelvalve */
-- 
2.17.0

