#!/bin/sh

# Load configs
CONFIG_FILE=/mnt/data/supervisor.json

CLI="$(jq --raw-output '.cli' $CONFIG_FILE)"
DOCKER_ARGS="$(jq --raw-output '.cli_args // empty' $CONFIG_FILE)"

##
# Main program
run_cli() {

    # Update CLI
    if $(docker --pull $CLI); then
        # FIXME: cleanup
    fi

    # Run CLI
    docker run --rm -ti $DOCKER_ARGS $CLI
    if [ $? -eq 10 ]; then
        sh
    fi
}

##
# Run endless CLI
while true; do
    run_cli
done
